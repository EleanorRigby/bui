/*! bui 2016-12-16 */
angular.module("bui",["ui.ace","ui.router","ngCookies","master","dashboard","login","deployment","deploymentManifest","deploymentInstances","deploymentSSH","deploymentIndex","deployments","stemcells","releases"]).config(["$stateProvider","$urlRouterProvider",function(a,b){"use strict";b.otherwise("/"),a.state("index",{url:"/",templateUrl:"app/components/dashboard/dashboard.html",controller:"DashboardController"}).state("login",{url:"/login",templateUrl:"app/components/login/login.html",controller:"LoginController"}).state("deployments",{url:"/deployments/",templateUrl:"app/components/deployments/deployments.html",controller:"DeploymentsController"}).state("deployment",{url:"^/deployments/:name",templateUrl:"app/components/deployment/deployment.html",controller:"DeploymentController"}).state("deployment.index",{url:"/index",templateUrl:"app/components/deployment/index.html",controller:"DeploymentIndexController"}).state("deployment.manifest",{url:"/manifest",templateUrl:"app/components/deployment/manifest.html",controller:"DeploymentManifestController"}).state("deployment.instances",{url:"/instances",templateUrl:"app/components/deployment/instances.html",controller:"DeploymentInstancesController"}).state("deployment.ssh",{url:"/vms/:vm_name/ssh",templateUrl:"app/components/deployment/ssh.html",controller:"DeploymentSSHController"}).state("stemcells",{url:"/stemcells/",templateUrl:"app/components/stemcells/stemcells.html",controller:"StemcellsController"}).state("releases",{url:"/releases/",templateUrl:"app/components/releases/releases.html",controller:"ReleasesController"})}]),angular.module("dashboard",[]).controller("DashboardController",["$scope","$http","$timeout",function(a,b,c){a.runningTasks=function(){b.get("/tasks/running",config).success(function(b,c){a.running_tasks=b,console.log(a.running_tasks)}).error(function(a,b){console.log("something went wrong getting running tasks")})},b.get("/info",config).success(function(b,c){a.info=b,console.log(a.info)}).error(function(a,b){console.log("something went wrong getting info")}),a.runningTasks(),a.intervalFunction=function(){c(function(){a.runningTasks(),a.intervalFunction()},5e3)},a.intervalFunction()}]),angular.module("master",[]).controller("MasterController",["$scope","$http","$state","$cookieStore",function(a,b,c,d){a.deployments=[],b.get("/deployments",config).success(function(b,c){a.deployments=b}).error(function(a,b){console.log("something went wrong getting deployments")}),b.get("/user",config).success(function(b,c){a.user=b}).error(function(b,d){a.logged_in=!1,console.log("something went logging in"),c.go("login")}),a.logout=function(){d.remove("auth")}}]),angular.module("deployment",[]).controller("DeploymentController",["$scope","$http","$stateParams","$state",function(a,b,c,d){a.name=c.name}]),angular.module("deploymentIndex",[]).controller("DeploymentIndexController",["$scope","$http","$stateParams",function(a,b,c){a.instances_count=0,b.get("/deployments/"+c.name,config).success(function(b,c){a.manifest=YAML.parse(b.manifest);for(var d=0;d<a.manifest.jobs.length;d++)a.instances_count+=a.manifest.jobs[d].instances;console.log(a.manifest)}).error(function(a,b){console.log("something went wrong getting deployment")}),a.getLifecycle=function(a){return"errand"==a?a:"service"}}]),angular.module("deploymentInstances",[]).controller("DeploymentInstancesController",["$scope","$http","$stateParams",function(a,b,c){b.get("/deployments/"+c.name+"/vms",config).success(function(b,c){a.instances=b}).error(function(a,b){console.log("something went wrong getting deployment")}),a.getLabel=function(a){return"running"==a?"success":"danger"}}]),angular.module("deploymentManifest",[]).controller("DeploymentManifestController",["$scope","$http","$stateParams",function(a,b,c){console.log("MANIFEST BRO"),b.get("/deployments/"+c.name,config).success(function(b,c){console.log(b),a.manifest=b.manifest}).error(function(a,b){console.log("something went wrong getting deployment")})}]),angular.module("deploymentSSH",[]).controller("DeploymentSSHController",["$scope","$http","$stateParams","$location",function(a,b,c,d){var e=new WebSocket("ws://"+d.host()+":"+d.port()+"/deployments/"+c.name+"/vms/"+c.vm_name+"/ssh");e.onerror=function(a){console.log("socket error",a)},e.onopen=function(a){var b=new Terminal({cols:120,rows:30,useStyle:!0,screenKeys:!0});b.open(document.getElementById("bash")),b.on("title",function(a){document.title=a}),b.on("data",function(a){e.send(btoa(a))}),e.onmessage=function(a){b.write(atob(a.data))}}}]),angular.module("deployments",[]).controller("DeploymentsController",["$scope","$http",function(a,b){b.get("/deployments",config).success(function(b,c){a.deployments=b}).error(function(a,b){console.log("something went wrong getting deployments")})}]),angular.module("login",[]).controller("LoginController",["$scope","$http","$window",function(a,b,c){a.login=function(a){var d=$.param({auth_type:"basic",username:a.name,password:a.password}),e={headers:{"Content-Type":"application/x-www-form-urlencoded"}};b.post("/login",d,e).success(function(a,b){console.log("login"),c.location.href="#/dashboard"}).error(function(a,b){console.log("fail"),c.location.href="#/login?error=unauthorized"})}}]),angular.module("releases",[]).controller("ReleasesController",["$scope","$http",function(a,b){b.get("/releases",config).success(function(b,c){a.releases=b}).error(function(a,b){console.log("something went wrong getting releases")}),a.getLabel=function(a){return a?"success":"danger"}}]),angular.module("stemcells",[]).controller("StemcellsController",["$scope","$http",function(a,b){b.get("/stemcells",config).success(function(b,c){a.stemcells=b}).error(function(a,b){console.log("something went wrong getting stemcells")})}]);